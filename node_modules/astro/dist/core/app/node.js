import * as fs from "fs";
import { App } from "./index.js";
import { deserializeManifest } from "./common.js";
function createURLFromRequest(req) {
  return new URL(`http://${req.headers.host}${req.url}`);
}
class NodeApp extends App {
  match(req) {
    return super.match(req instanceof URL ? req : createURLFromRequest(req));
  }
  render(req) {
    return super.render(req instanceof URL ? req : createURLFromRequest(req));
  }
}
async function loadManifest(rootFolder) {
  const manifestFile = new URL("./manifest.json", rootFolder);
  const rawManifest = await fs.promises.readFile(manifestFile, "utf-8");
  const serializedManifest = JSON.parse(rawManifest);
  return deserializeManifest(serializedManifest);
}
async function loadApp(rootFolder) {
  const manifest = await loadManifest(rootFolder);
  return new NodeApp(manifest, rootFolder);
}
export {
  loadApp,
  loadManifest
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vc3JjL2NvcmUvYXBwL25vZGUudHMiXSwKICAibWFwcGluZ3MiOiAiQUFFQTtBQUNBO0FBQ0E7QUFHQSw4QkFBOEIsS0FBMkI7QUFDeEQsU0FBTyxJQUFJLElBQUksVUFBVSxJQUFJLFFBQVEsT0FBTyxJQUFJO0FBQUE7QUFHakQsc0JBQXNCLElBQUk7QUFBQSxFQUN6QixNQUFNLEtBQTRCO0FBQ2pDLFdBQU8sTUFBTSxNQUFNLGVBQWUsTUFBTSxNQUFNLHFCQUFxQjtBQUFBO0FBQUEsRUFFcEUsT0FBTyxLQUE0QjtBQUNsQyxXQUFPLE1BQU0sT0FBTyxlQUFlLE1BQU0sTUFBTSxxQkFBcUI7QUFBQTtBQUFBO0FBSXRFLDRCQUFtQyxZQUF1QztBQUN6RSxRQUFNLGVBQWUsSUFBSSxJQUFJLG1CQUFtQjtBQUNoRCxRQUFNLGNBQWMsTUFBTSxHQUFHLFNBQVMsU0FBUyxjQUFjO0FBQzdELFFBQU0scUJBQTRDLEtBQUssTUFBTTtBQUM3RCxTQUFPLG9CQUFvQjtBQUFBO0FBRzVCLHVCQUE4QixZQUFtQztBQUNoRSxRQUFNLFdBQVcsTUFBTSxhQUFhO0FBQ3BDLFNBQU8sSUFBSSxRQUFRLFVBQVU7QUFBQTsiLAogICJuYW1lcyI6IFtdCn0K
