import { resolveDependency } from "../../util.js";
import { createRenderer } from "../renderer.js";
const cache = new Map();
async function resolveRenderer(viteServer, renderer, astroConfig) {
  const resolvedRenderer = await createRenderer(renderer, {
    renderer(name) {
      return import(resolveDependency(name, astroConfig));
    },
    async server(entry) {
      const { url } = await viteServer.moduleGraph.ensureEntryFromUrl(entry);
      const mod = await viteServer.ssrLoadModule(url);
      return mod;
    }
  });
  return resolvedRenderer;
}
async function resolveRenderers(viteServer, astroConfig) {
  const ids = astroConfig.renderers;
  const renderers = await Promise.all(ids.map((renderer) => {
    if (cache.has(renderer))
      return cache.get(renderer);
    let promise = resolveRenderer(viteServer, renderer, astroConfig);
    cache.set(renderer, promise);
    return promise;
  }));
  return renderers;
}
export {
  resolveRenderers
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vc3JjL2NvcmUvcmVuZGVyL2Rldi9yZW5kZXJlcnMudHMiXSwKICAibWFwcGluZ3MiOiAiQUFHQTtBQUNBO0FBRUEsTUFBTSxRQUFRLElBQUk7QUFFbEIsK0JBQStCLFlBQWdDLFVBQWtCLGFBQTZDO0FBQzdILFFBQU0sbUJBQTZCLE1BQU0sZUFBZSxVQUFVO0FBQUEsSUFDakUsU0FBUyxNQUFNO0FBQ2QsYUFBTyxPQUFPLGtCQUFrQixNQUFNO0FBQUE7QUFBQSxVQUVqQyxPQUFPLE9BQU87QUFDbkIsWUFBTSxFQUFFLFFBQVEsTUFBTSxXQUFXLFlBQVksbUJBQW1CO0FBQ2hFLFlBQU0sTUFBTSxNQUFNLFdBQVcsY0FBYztBQUMzQyxhQUFPO0FBQUE7QUFBQTtBQUlULFNBQU87QUFBQTtBQUdSLGdDQUF1QyxZQUFnQyxhQUErQztBQUNySCxRQUFNLE1BQWdCLFlBQVk7QUFDbEMsUUFBTSxZQUFZLE1BQU0sUUFBUSxJQUMvQixJQUFJLElBQUksQ0FBQyxhQUFhO0FBQ3JCLFFBQUksTUFBTSxJQUFJO0FBQVcsYUFBTyxNQUFNLElBQUk7QUFDMUMsUUFBSSxVQUFVLGdCQUFnQixZQUFZLFVBQVU7QUFDcEQsVUFBTSxJQUFJLFVBQVU7QUFDcEIsV0FBTztBQUFBO0FBSVQsU0FBTztBQUFBOyIsCiAgIm5hbWVzIjogW10KfQo=
