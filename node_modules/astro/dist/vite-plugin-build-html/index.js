var __defProp = Object.defineProperty;
var __defProps = Object.defineProperties;
var __getOwnPropDescs = Object.getOwnPropertyDescriptors;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));
import parse5 from "parse5";
import srcsetParse from "srcset-parse";
import * as npath from "path";
import { promises as fs } from "fs";
import { getAttribute, hasAttribute, insertBefore, remove, createScript, createElement, setAttribute } from "@web/parse5-utils";
import { addRollupInput } from "./add-rollup-input.js";
import { findAssets, findExternalScripts, findInlineScripts, findInlineStyles, getTextContent, getAttributes } from "./extract-assets.js";
import { isBuildableImage, isBuildableLink, isHoistedScript, isInSrcDirectory, hasSrcSet } from "./util.js";
import { render as ssrRender } from "../core/render/dev/index.js";
import { getAstroStyleId, getAstroPageStyleId } from "../vite-plugin-build-css/index.js";
import { prependDotSlash, removeEndingForwardSlash } from "../core/path.js";
const matchSrcset = srcsetParse.default;
const PLUGIN_NAME = "@astro/rollup-plugin-build";
const ASTRO_PAGE_PREFIX = "@astro-page";
const ASTRO_SCRIPT_PREFIX = "@astro-script";
const ASTRO_EMPTY = "@astro-empty";
const STATUS_CODE_REGEXP = /^[0-9]{3}$/;
function relativePath(from, to) {
  const rel = npath.posix.relative(from, to);
  return prependDotSlash(rel);
}
function rollupPluginAstroBuildHTML(options) {
  const { astroConfig, internals, logging, origin, allPages, routeCache, viteServer, pageNames } = options;
  const srcRoot = astroConfig.src.pathname;
  const srcRootWeb = srcRoot.substr(astroConfig.projectRoot.pathname.length - 1);
  const renderedPageMap = new Map();
  const astroScriptMap = new Map();
  const astroPageMap = new Map();
  const astroAssetMap = new Map();
  const cssChunkMap = new Map();
  const pageStyleImportOrder = [];
  return {
    name: PLUGIN_NAME,
    enforce: "pre",
    async options(inputOptions) {
      const htmlInput = new Set();
      const assetInput = new Set();
      const jsInput = new Set();
      for (const [component, pageData] of Object.entries(allPages)) {
        const [renderers, mod] = pageData.preload;
        for (const path of mod.$$metadata.hydratedComponentPaths()) {
          jsInput.add(path);
        }
        for (const pathname of pageData.paths) {
          pageNames.push(pathname.replace(/\/?$/, "/").replace(/^\//, ""));
          const id = ASTRO_PAGE_PREFIX + pathname;
          const html = await ssrRender(renderers, mod, {
            astroConfig,
            filePath: new URL(`./${component}`, astroConfig.projectRoot),
            logging,
            mode: "production",
            origin,
            pathname,
            route: pageData.route,
            routeCache,
            viteServer
          });
          renderedPageMap.set(id, html);
          const document = parse5.parse(html, {
            sourceCodeLocationInfo: true
          });
          const frontEndImports = [];
          for (const script of findInlineScripts(document)) {
            const astroScript = getAttribute(script, "astro-script");
            if (astroScript) {
              const js = getTextContent(script);
              const scriptId = ASTRO_SCRIPT_PREFIX + astroScript;
              frontEndImports.push(scriptId);
              astroScriptMap.set(scriptId, js);
            }
          }
          for (const script of findExternalScripts(document)) {
            if (isHoistedScript(script)) {
              const astroScript = getAttribute(script, "astro-script");
              const src = getAttribute(script, "src");
              if (astroScript) {
                const js = `import '${src}';`;
                const scriptId = ASTRO_SCRIPT_PREFIX + astroScript;
                frontEndImports.push(scriptId);
                astroScriptMap.set(scriptId, js);
              }
            } else if (isInSrcDirectory(script, "src", srcRoot, srcRootWeb)) {
              const src = getAttribute(script, "src");
              if (src)
                jsInput.add(src);
            }
          }
          const assetImports = [];
          const styleId = getAstroStyleId(pathname);
          let styles = 0;
          for (const node of findInlineStyles(document)) {
            if (hasAttribute(node, "astro-style")) {
              const style = getTextContent(node) || " ";
              const thisStyleId = `${styleId}/${++styles}.css`;
              internals.astroStyleMap.set(thisStyleId, style);
              assetImports.push(thisStyleId);
            }
          }
          for (let node of findAssets(document)) {
            if (isBuildableLink(node, srcRoot, srcRootWeb)) {
              const href = getAttribute(node, "href");
              assetImports.push(href);
            }
            if (isBuildableImage(node, srcRoot, srcRootWeb)) {
              const src = getAttribute(node, "src");
              if ((src == null ? void 0 : src.startsWith(srcRoot)) && !astroAssetMap.has(src)) {
                astroAssetMap.set(src, fs.readFile(new URL(`file://${src}`)));
              } else if ((src == null ? void 0 : src.startsWith(srcRootWeb)) && !astroAssetMap.has(src)) {
                const resolved = new URL("." + src, astroConfig.projectRoot);
                astroAssetMap.set(src, fs.readFile(resolved));
              }
            }
            if (hasSrcSet(node)) {
              const candidates = matchSrcset(getAttribute(node, "srcset"));
              for (const { url } of candidates) {
                if (url.startsWith(srcRoot) && !astroAssetMap.has(url)) {
                  astroAssetMap.set(url, fs.readFile(new URL(`file://${url}`)));
                } else if (url.startsWith(srcRootWeb) && !astroAssetMap.has(url)) {
                  const resolved = new URL("." + url, astroConfig.projectRoot);
                  astroAssetMap.set(url, fs.readFile(resolved));
                }
              }
            }
          }
          if (frontEndImports.length) {
            htmlInput.add(id);
            const jsSource = frontEndImports.map((sid) => `import '${sid}';`).join("\n");
            astroPageMap.set(id, jsSource);
          }
          if (assetImports.length) {
            const pageStyleId = getAstroPageStyleId(pathname);
            const jsSource = assetImports.map((sid) => `import '${sid}';`).join("\n");
            internals.astroPageStyleMap.set(pageStyleId, jsSource);
            assetInput.add(pageStyleId);
            for (const assetHref of assetImports) {
              if (!pageStyleImportOrder.includes(assetHref))
                pageStyleImportOrder.push(assetHref);
            }
          }
        }
      }
      const allInputs = new Set([...jsInput, ...htmlInput, ...assetInput]);
      if (!allInputs.size) {
        allInputs.add(ASTRO_EMPTY);
      }
      const outOptions = addRollupInput(inputOptions, Array.from(allInputs));
      return outOptions;
    },
    async resolveId(id) {
      switch (true) {
        case astroScriptMap.has(id):
        case astroPageMap.has(id):
        case id === ASTRO_EMPTY: {
          return id;
        }
      }
      return void 0;
    },
    async load(id) {
      if (astroPageMap.has(id)) {
        return astroPageMap.get(id);
      }
      if (astroScriptMap.has(id)) {
        return astroScriptMap.get(id);
      }
      if (id === ASTRO_EMPTY) {
        return 'console.log("empty");';
      }
      return null;
    },
    outputOptions(outputOptions) {
      Object.assign(outputOptions, {
        entryFileNames(chunk) {
          if (chunk.name.startsWith(ASTRO_PAGE_PREFIX)) {
            let pageName = chunk.name.substr(ASTRO_PAGE_PREFIX.length + 1);
            if (!pageName) {
              pageName = "index";
            }
            return `assets/${pageName}.[hash].js`;
          }
          return "assets/[name].[hash].js";
        }
      });
      return outputOptions;
    },
    async generateBundle(_options, bundle) {
      const facadeIdMap = new Map();
      for (const [chunkId, output] of Object.entries(bundle)) {
        if (output.type === "chunk") {
          const chunk = output;
          const id = chunk.facadeModuleId;
          if (id === ASTRO_EMPTY) {
            delete bundle[chunkId];
          } else if (id) {
            facadeIdMap.set(id, chunk.fileName);
          }
        }
      }
      const assetIdMap = new Map();
      for (const [assetPath, dataPromise] of astroAssetMap) {
        const referenceId = this.emitFile({
          type: "asset",
          name: npath.basename(assetPath),
          source: await dataPromise
        });
        assetIdMap.set(assetPath, referenceId);
      }
      const sortedCSSChunks = [...internals.pureCSSChunks];
      sortedCSSChunks.sort((a, b) => {
        let aIndex = Math.min(...Object.keys(a.modules).map((id) => {
          const i = pageStyleImportOrder.findIndex((url) => id.endsWith(url));
          return i >= 0 ? i : Infinity;
        }));
        let bIndex = Math.min(...Object.keys(b.modules).map((id) => {
          const i = pageStyleImportOrder.findIndex((url) => id.endsWith(url));
          return i >= 0 ? i : Infinity;
        }));
        return aIndex - bIndex;
      });
      const sortedChunkNames = sortedCSSChunks.map(({ fileName }) => fileName);
      for (const chunk of sortedCSSChunks) {
        const chunkModules = [chunk.fileName, ...chunk.imports];
        chunkModules.sort((a, b) => sortedChunkNames.indexOf(a) - sortedChunkNames.indexOf(b));
        const referenceIDs = [];
        for (const chunkID of chunkModules) {
          const referenceID = internals.chunkToReferenceIdMap.get(chunkID);
          if (referenceID)
            referenceIDs.push(referenceID);
        }
        for (const id of Object.keys(chunk.modules)) {
          cssChunkMap.set(id, referenceIDs);
        }
      }
      const linkChunksAdded = new Set();
      const appendStyleChunksBefore = (ref, pathname, referenceIds, attrs = {}) => {
        let added = false;
        if (referenceIds) {
          const lastNode = ref;
          for (const referenceId of referenceIds) {
            const chunkFileName = this.getFileName(referenceId);
            const relPath = relativePath(pathname, "/" + chunkFileName);
            const key = pathname + relPath + attrs.rel || "stylesheet";
            if (!linkChunksAdded.has(key)) {
              linkChunksAdded.add(key);
              insertBefore(lastNode.parentNode, createElement("link", __spreadProps(__spreadValues({
                rel: "stylesheet"
              }, attrs), {
                href: relPath
              })), lastNode);
              added = true;
            }
          }
        }
        return added;
      };
      for (const [id, html] of renderedPageMap) {
        const pathname = id.substr(ASTRO_PAGE_PREFIX.length);
        const document = parse5.parse(html, {
          sourceCodeLocationInfo: true
        });
        const pageAssetId = facadeIdMap.get(id);
        const bundlePath = "/" + pageAssetId;
        let pageBundleAdded = false;
        for (let script of findInlineScripts(document)) {
          if (getAttribute(script, "astro-script") && typeof pageAssetId === "string") {
            if (!pageBundleAdded) {
              pageBundleAdded = true;
              const relPath = relativePath(pathname, bundlePath);
              insertBefore(script.parentNode, createScript({
                type: "module",
                src: relPath
              }), script);
            }
            remove(script);
          }
        }
        for (let script of findExternalScripts(document)) {
          if (getAttribute(script, "astro-script") && typeof pageAssetId === "string") {
            if (!pageBundleAdded) {
              pageBundleAdded = true;
              const relPath = relativePath(pathname, bundlePath);
              insertBefore(script.parentNode, createScript({
                type: "module",
                src: relPath
              }), script);
            }
            remove(script);
          } else if (isInSrcDirectory(script, "src", srcRoot, srcRootWeb)) {
            let src = getAttribute(script, "src");
            if (src == null ? void 0 : src.startsWith(srcRootWeb)) {
              src = new URL("." + src, astroConfig.projectRoot).pathname;
            }
            if (src && (facadeIdMap.has(src) || facadeIdMap.has(src.substr(1)))) {
              const assetRootPath = "/" + (facadeIdMap.get(src) || facadeIdMap.get(src.substr(1)));
              const relPath = relativePath(pathname, assetRootPath);
              const attrs = getAttributes(script);
              insertBefore(script.parentNode, createScript(__spreadProps(__spreadValues({}, attrs), {
                src: relPath
              })), script);
              remove(script);
            }
          }
        }
        const styleId = getAstroPageStyleId(pathname);
        let pageCSSAdded = false;
        for (const node of findAssets(document)) {
          if (isBuildableLink(node, srcRoot, srcRootWeb)) {
            const rel = getAttribute(node, "rel");
            switch (rel) {
              case "stylesheet": {
                if (!pageCSSAdded) {
                  const attrs = getAttributes(node);
                  delete attrs["data-astro-injected"];
                  pageCSSAdded = appendStyleChunksBefore(node, pathname, cssChunkMap.get(styleId), attrs);
                }
                remove(node);
                break;
              }
              case "preload": {
                if (getAttribute(node, "as") === "style") {
                  const attrs = getAttributes(node);
                  appendStyleChunksBefore(node, pathname, cssChunkMap.get(styleId), attrs);
                  remove(node);
                }
              }
            }
          }
          if (isBuildableImage(node, srcRoot, srcRootWeb)) {
            const src = getAttribute(node, "src");
            const referenceId = assetIdMap.get(src);
            if (referenceId) {
              const fileName = this.getFileName(referenceId);
              const relPath = relativePath(pathname, "/" + fileName);
              setAttribute(node, "src", relPath);
            }
          }
          if (hasSrcSet(node)) {
            const srcset = getAttribute(node, "srcset");
            let changedSrcset = srcset;
            const urls = matchSrcset(srcset).map((c) => c.url);
            for (const url of urls) {
              if (assetIdMap.has(url)) {
                const referenceId = assetIdMap.get(url);
                const fileName = this.getFileName(referenceId);
                const relPath = relativePath(pathname, "/" + fileName);
                changedSrcset = changedSrcset.replace(url, relPath);
              }
            }
            if (changedSrcset !== srcset) {
              setAttribute(node, "srcset", changedSrcset);
            }
          }
        }
        for (const style of findInlineStyles(document)) {
          if (hasAttribute(style, "astro-style")) {
            if (!pageCSSAdded) {
              pageCSSAdded = appendStyleChunksBefore(style, pathname, cssChunkMap.get(styleId));
            }
            remove(style);
          }
        }
        const outHTML = parse5.serialize(document);
        const name = pathname.substr(1);
        let outPath;
        if (astroConfig.buildOptions.pageUrlFormat === "file" || STATUS_CODE_REGEXP.test(name)) {
          outPath = `${removeEndingForwardSlash(name || "index")}.html`;
        } else {
          outPath = npath.posix.join(name, "index.html");
        }
        this.emitFile({
          fileName: outPath,
          source: outHTML,
          type: "asset"
        });
      }
    }
  };
}
export {
  rollupPluginAstroBuildHTML
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL3ZpdGUtcGx1Z2luLWJ1aWxkLWh0bWwvaW5kZXgudHMiXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBLE1BQU0sY0FBbUMsWUFBb0I7QUFFN0QsTUFBTSxjQUFjO0FBQ3BCLE1BQU0sb0JBQW9CO0FBQzFCLE1BQU0sc0JBQXNCO0FBRTVCLE1BQU0sY0FBYztBQUNwQixNQUFNLHFCQUFxQjtBQWEzQixzQkFBc0IsTUFBYyxJQUFvQjtBQUN2RCxRQUFNLE1BQU0sTUFBTSxNQUFNLFNBQVMsTUFBTTtBQUN2QyxTQUFPLGdCQUFnQjtBQUFBO0FBR2pCLG9DQUFvQyxTQUFvQztBQUM5RSxRQUFNLEVBQUUsYUFBYSxXQUFXLFNBQVMsUUFBUSxVQUFVLFlBQVksWUFBWSxjQUFjO0FBR2pHLFFBQU0sVUFBVSxZQUFZLElBQUk7QUFFaEMsUUFBTSxhQUFhLFFBQVEsT0FBTyxZQUFZLFlBQVksU0FBUyxTQUFTO0FBRzVFLFFBQU0sa0JBQWtCLElBQUk7QUFHNUIsUUFBTSxpQkFBaUIsSUFBSTtBQUMzQixRQUFNLGVBQWUsSUFBSTtBQUN6QixRQUFNLGdCQUFnQixJQUFJO0FBRTFCLFFBQU0sY0FBYyxJQUFJO0FBQ3hCLFFBQU0sdUJBQWlDO0FBRXZDLFNBQU87QUFBQSxJQUNOLE1BQU07QUFBQSxJQUVOLFNBQVM7QUFBQSxVQUVILFFBQVEsY0FBYztBQUMzQixZQUFNLFlBQXlCLElBQUk7QUFDbkMsWUFBTSxhQUEwQixJQUFJO0FBQ3BDLFlBQU0sVUFBdUIsSUFBSTtBQUVqQyxpQkFBVyxDQUFDLFdBQVcsYUFBYSxPQUFPLFFBQVEsV0FBVztBQUM3RCxjQUFNLENBQUMsV0FBVyxPQUFPLFNBQVM7QUFHbEMsbUJBQVcsUUFBUSxJQUFJLFdBQVcsMEJBQTBCO0FBQzNELGtCQUFRLElBQUk7QUFBQTtBQUdiLG1CQUFXLFlBQVksU0FBUyxPQUFPO0FBQ3RDLG9CQUFVLEtBQUssU0FBUyxRQUFRLFFBQVEsS0FBSyxRQUFRLE9BQU87QUFDNUQsZ0JBQU0sS0FBSyxvQkFBb0I7QUFDL0IsZ0JBQU0sT0FBTyxNQUFNLFVBQVUsV0FBVyxLQUFLO0FBQUEsWUFDNUM7QUFBQSxZQUNBLFVBQVUsSUFBSSxJQUFJLEtBQUssYUFBYSxZQUFZO0FBQUEsWUFDaEQ7QUFBQSxZQUNBLE1BQU07QUFBQSxZQUNOO0FBQUEsWUFDQTtBQUFBLFlBQ0EsT0FBTyxTQUFTO0FBQUEsWUFDaEI7QUFBQSxZQUNBO0FBQUE7QUFFRCwwQkFBZ0IsSUFBSSxJQUFJO0FBRXhCLGdCQUFNLFdBQVcsT0FBTyxNQUFNLE1BQU07QUFBQSxZQUNuQyx3QkFBd0I7QUFBQTtBQUd6QixnQkFBTSxrQkFBa0I7QUFDeEIscUJBQVcsVUFBVSxrQkFBa0IsV0FBVztBQUNqRCxrQkFBTSxjQUFjLGFBQWEsUUFBUTtBQUN6QyxnQkFBSSxhQUFhO0FBQ2hCLG9CQUFNLEtBQUssZUFBZTtBQUMxQixvQkFBTSxXQUFXLHNCQUFzQjtBQUN2Qyw4QkFBZ0IsS0FBSztBQUNyQiw2QkFBZSxJQUFJLFVBQVU7QUFBQTtBQUFBO0FBSS9CLHFCQUFXLFVBQVUsb0JBQW9CLFdBQVc7QUFDbkQsZ0JBQUksZ0JBQWdCLFNBQVM7QUFDNUIsb0JBQU0sY0FBYyxhQUFhLFFBQVE7QUFDekMsb0JBQU0sTUFBTSxhQUFhLFFBQVE7QUFDakMsa0JBQUksYUFBYTtBQUNoQixzQkFBTSxLQUFLLFdBQVc7QUFDdEIsc0JBQU0sV0FBVyxzQkFBc0I7QUFDdkMsZ0NBQWdCLEtBQUs7QUFDckIsK0JBQWUsSUFBSSxVQUFVO0FBQUE7QUFBQSx1QkFFcEIsaUJBQWlCLFFBQVEsT0FBTyxTQUFTLGFBQWE7QUFDaEUsb0JBQU0sTUFBTSxhQUFhLFFBQVE7QUFDakMsa0JBQUk7QUFBSyx3QkFBUSxJQUFJO0FBQUE7QUFBQTtBQUl2QixnQkFBTSxlQUFlO0FBQ3JCLGdCQUFNLFVBQVUsZ0JBQWdCO0FBQ2hDLGNBQUksU0FBUztBQUNiLHFCQUFXLFFBQVEsaUJBQWlCLFdBQVc7QUFDOUMsZ0JBQUksYUFBYSxNQUFNLGdCQUFnQjtBQUN0QyxvQkFBTSxRQUFRLGVBQWUsU0FBUztBQUN0QyxvQkFBTSxjQUFjLEdBQUcsV0FBVyxFQUFFO0FBQ3BDLHdCQUFVLGNBQWMsSUFBSSxhQUFhO0FBQ3pDLDJCQUFhLEtBQUs7QUFBQTtBQUFBO0FBSXBCLG1CQUFTLFFBQVEsV0FBVyxXQUFXO0FBQ3RDLGdCQUFJLGdCQUFnQixNQUFNLFNBQVMsYUFBYTtBQUMvQyxvQkFBTSxPQUFPLGFBQWEsTUFBTTtBQUNoQywyQkFBYSxLQUFLO0FBQUE7QUFHbkIsZ0JBQUksaUJBQWlCLE1BQU0sU0FBUyxhQUFhO0FBQ2hELG9CQUFNLE1BQU0sYUFBYSxNQUFNO0FBQy9CLGtCQUFJLDRCQUFLLFdBQVcsYUFBWSxDQUFDLGNBQWMsSUFBSSxNQUFNO0FBQ3hELDhCQUFjLElBQUksS0FBSyxHQUFHLFNBQVMsSUFBSSxJQUFJLFVBQVU7QUFBQSx5QkFDM0MsNEJBQUssV0FBVyxnQkFBZSxDQUFDLGNBQWMsSUFBSSxNQUFNO0FBQ2xFLHNCQUFNLFdBQVcsSUFBSSxJQUFJLE1BQU0sS0FBSyxZQUFZO0FBQ2hELDhCQUFjLElBQUksS0FBSyxHQUFHLFNBQVM7QUFBQTtBQUFBO0FBSXJDLGdCQUFJLFVBQVUsT0FBTztBQUNwQixvQkFBTSxhQUFhLFlBQVksYUFBYSxNQUFNO0FBQ2xELHlCQUFXLEVBQUUsU0FBUyxZQUFZO0FBQ2pDLG9CQUFJLElBQUksV0FBVyxZQUFZLENBQUMsY0FBYyxJQUFJLE1BQU07QUFDdkQsZ0NBQWMsSUFBSSxLQUFLLEdBQUcsU0FBUyxJQUFJLElBQUksVUFBVTtBQUFBLDJCQUMzQyxJQUFJLFdBQVcsZUFBZSxDQUFDLGNBQWMsSUFBSSxNQUFNO0FBQ2pFLHdCQUFNLFdBQVcsSUFBSSxJQUFJLE1BQU0sS0FBSyxZQUFZO0FBQ2hELGdDQUFjLElBQUksS0FBSyxHQUFHLFNBQVM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU12QyxjQUFJLGdCQUFnQixRQUFRO0FBQzNCLHNCQUFVLElBQUk7QUFDZCxrQkFBTSxXQUFXLGdCQUFnQixJQUFJLENBQUMsUUFBUSxXQUFXLFNBQVMsS0FBSztBQUN2RSx5QkFBYSxJQUFJLElBQUk7QUFBQTtBQUd0QixjQUFJLGFBQWEsUUFBUTtBQUN4QixrQkFBTSxjQUFjLG9CQUFvQjtBQUN4QyxrQkFBTSxXQUFXLGFBQWEsSUFBSSxDQUFDLFFBQVEsV0FBVyxTQUFTLEtBQUs7QUFDcEUsc0JBQVUsa0JBQWtCLElBQUksYUFBYTtBQUM3Qyx1QkFBVyxJQUFJO0FBR2YsdUJBQVcsYUFBYSxjQUFjO0FBQ3JDLGtCQUFJLENBQUMscUJBQXFCLFNBQVM7QUFBWSxxQ0FBcUIsS0FBSztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBTTdFLFlBQU0sWUFBWSxJQUFJLElBQUksQ0FBQyxHQUFHLFNBQVMsR0FBRyxXQUFXLEdBQUc7QUFFeEQsVUFBSSxDQUFDLFVBQVUsTUFBTTtBQUNwQixrQkFBVSxJQUFJO0FBQUE7QUFFZixZQUFNLGFBQWEsZUFBZSxjQUFjLE1BQU0sS0FBSztBQUMzRCxhQUFPO0FBQUE7QUFBQSxVQUdGLFVBQVUsSUFBSTtBQUNuQixjQUFRO0FBQUEsYUFDRixlQUFlLElBQUk7QUFBQSxhQUNuQixhQUFhLElBQUk7QUFBQSxhQUNqQixPQUFPLGFBQWE7QUFDeEIsaUJBQU87QUFBQTtBQUFBO0FBSVQsYUFBTztBQUFBO0FBQUEsVUFHRixLQUFLLElBQUk7QUFFZCxVQUFJLGFBQWEsSUFBSSxLQUFLO0FBQ3pCLGVBQU8sYUFBYSxJQUFJO0FBQUE7QUFHekIsVUFBSSxlQUFlLElBQUksS0FBSztBQUMzQixlQUFPLGVBQWUsSUFBSTtBQUFBO0FBRzNCLFVBQUksT0FBTyxhQUFhO0FBQ3ZCLGVBQU87QUFBQTtBQUdSLGFBQU87QUFBQTtBQUFBLElBR1IsY0FBYyxlQUFlO0FBQzVCLGFBQU8sT0FBTyxlQUFlO0FBQUEsUUFDNUIsZUFBZSxPQUF5QjtBQUV2QyxjQUFJLE1BQU0sS0FBSyxXQUFXLG9CQUFvQjtBQUM3QyxnQkFBSSxXQUFXLE1BQU0sS0FBSyxPQUFPLGtCQUFrQixTQUFTO0FBQzVELGdCQUFJLENBQUMsVUFBVTtBQUNkLHlCQUFXO0FBQUE7QUFFWixtQkFBTyxVQUFVO0FBQUE7QUFFbEIsaUJBQU87QUFBQTtBQUFBO0FBR1QsYUFBTztBQUFBO0FBQUEsVUFHRixlQUFlLFVBQVUsUUFBUTtBQUN0QyxZQUFNLGNBQWMsSUFBSTtBQUN4QixpQkFBVyxDQUFDLFNBQVMsV0FBVyxPQUFPLFFBQVEsU0FBUztBQUN2RCxZQUFJLE9BQU8sU0FBUyxTQUFTO0FBQzVCLGdCQUFNLFFBQVE7QUFDZCxnQkFBTSxLQUFLLE1BQU07QUFDakIsY0FBSSxPQUFPLGFBQWE7QUFDdkIsbUJBQU8sT0FBTztBQUFBLHFCQUNKLElBQUk7QUFDZCx3QkFBWSxJQUFJLElBQUksTUFBTTtBQUFBO0FBQUE7QUFBQTtBQU03QixZQUFNLGFBQWEsSUFBSTtBQUN2QixpQkFBVyxDQUFDLFdBQVcsZ0JBQWdCLGVBQWU7QUFDckQsY0FBTSxjQUFjLEtBQUssU0FBUztBQUFBLFVBQ2pDLE1BQU07QUFBQSxVQUNOLE1BQU0sTUFBTSxTQUFTO0FBQUEsVUFDckIsUUFBUSxNQUFNO0FBQUE7QUFFZixtQkFBVyxJQUFJLFdBQVc7QUFBQTtBQUszQixZQUFNLGtCQUFrQixDQUFDLEdBQUcsVUFBVTtBQUN0QyxzQkFBZ0IsS0FBSyxDQUFDLEdBQUcsTUFBTTtBQUM5QixZQUFJLFNBQVMsS0FBSyxJQUNqQixHQUFHLE9BQU8sS0FBSyxFQUFFLFNBQVMsSUFBSSxDQUFDLE9BQU87QUFDckMsZ0JBQU0sSUFBSSxxQkFBcUIsVUFBVSxDQUFDLFFBQVEsR0FBRyxTQUFTO0FBQzlELGlCQUFPLEtBQUssSUFBSSxJQUFJO0FBQUE7QUFHdEIsWUFBSSxTQUFTLEtBQUssSUFDakIsR0FBRyxPQUFPLEtBQUssRUFBRSxTQUFTLElBQUksQ0FBQyxPQUFPO0FBQ3JDLGdCQUFNLElBQUkscUJBQXFCLFVBQVUsQ0FBQyxRQUFRLEdBQUcsU0FBUztBQUM5RCxpQkFBTyxLQUFLLElBQUksSUFBSTtBQUFBO0FBR3RCLGVBQU8sU0FBUztBQUFBO0FBRWpCLFlBQU0sbUJBQW1CLGdCQUFnQixJQUFJLENBQUMsRUFBRSxlQUFlO0FBSS9ELGlCQUFXLFNBQVMsaUJBQWlCO0FBQ3BDLGNBQU0sZUFBZSxDQUFDLE1BQU0sVUFBVSxHQUFHLE1BQU07QUFLL0MscUJBQWEsS0FBSyxDQUFDLEdBQUcsTUFBTSxpQkFBaUIsUUFBUSxLQUFLLGlCQUFpQixRQUFRO0FBRW5GLGNBQU0sZUFBeUI7QUFDL0IsbUJBQVcsV0FBVyxjQUFjO0FBQ25DLGdCQUFNLGNBQWMsVUFBVSxzQkFBc0IsSUFBSTtBQUN4RCxjQUFJO0FBQWEseUJBQWEsS0FBSztBQUFBO0FBRXBDLG1CQUFXLE1BQU0sT0FBTyxLQUFLLE1BQU0sVUFBVTtBQUM1QyxzQkFBWSxJQUFJLElBQUk7QUFBQTtBQUFBO0FBS3RCLFlBQU0sa0JBQWtCLElBQUk7QUFDNUIsWUFBTSwwQkFBMEIsQ0FBQyxLQUFxQixVQUFrQixjQUFvQyxRQUE2QixPQUFPO0FBQy9JLFlBQUksUUFBUTtBQUNaLFlBQUksY0FBYztBQUNqQixnQkFBTSxXQUFXO0FBQ2pCLHFCQUFXLGVBQWUsY0FBYztBQUN2QyxrQkFBTSxnQkFBZ0IsS0FBSyxZQUFZO0FBQ3ZDLGtCQUFNLFVBQVUsYUFBYSxVQUFVLE1BQU07QUFHN0Msa0JBQU0sTUFBTSxXQUFXLFVBQVUsTUFBTSxPQUFPO0FBQzlDLGdCQUFJLENBQUMsZ0JBQWdCLElBQUksTUFBTTtBQUM5Qiw4QkFBZ0IsSUFBSTtBQUNwQiwyQkFDQyxTQUFTLFlBQ1QsY0FBYyxRQUFRO0FBQUEsZ0JBQ3JCLEtBQUs7QUFBQSxpQkFDRixRQUZrQjtBQUFBLGdCQUdyQixNQUFNO0FBQUEsbUJBRVA7QUFFRCxzQkFBUTtBQUFBO0FBQUE7QUFBQTtBQUlYLGVBQU87QUFBQTtBQUdSLGlCQUFXLENBQUMsSUFBSSxTQUFTLGlCQUFpQjtBQUN6QyxjQUFNLFdBQVcsR0FBRyxPQUFPLGtCQUFrQjtBQUM3QyxjQUFNLFdBQVcsT0FBTyxNQUFNLE1BQU07QUFBQSxVQUNuQyx3QkFBd0I7QUFBQTtBQUt6QixjQUFNLGNBQWMsWUFBWSxJQUFJO0FBQ3BDLGNBQU0sYUFBYSxNQUFNO0FBR3pCLFlBQUksa0JBQWtCO0FBR3RCLGlCQUFTLFVBQVUsa0JBQWtCLFdBQVc7QUFDL0MsY0FBSSxhQUFhLFFBQVEsbUJBQW1CLE9BQU8sZ0JBQWdCLFVBQVU7QUFDNUUsZ0JBQUksQ0FBQyxpQkFBaUI7QUFDckIsZ0NBQWtCO0FBQ2xCLG9CQUFNLFVBQVUsYUFBYSxVQUFVO0FBQ3ZDLDJCQUNDLE9BQU8sWUFDUCxhQUFhO0FBQUEsZ0JBQ1osTUFBTTtBQUFBLGdCQUNOLEtBQUs7QUFBQSxrQkFFTjtBQUFBO0FBR0YsbUJBQU87QUFBQTtBQUFBO0FBS1QsaUJBQVMsVUFBVSxvQkFBb0IsV0FBVztBQUNqRCxjQUFJLGFBQWEsUUFBUSxtQkFBbUIsT0FBTyxnQkFBZ0IsVUFBVTtBQUM1RSxnQkFBSSxDQUFDLGlCQUFpQjtBQUNyQixnQ0FBa0I7QUFDbEIsb0JBQU0sVUFBVSxhQUFhLFVBQVU7QUFDdkMsMkJBQ0MsT0FBTyxZQUNQLGFBQWE7QUFBQSxnQkFDWixNQUFNO0FBQUEsZ0JBQ04sS0FBSztBQUFBLGtCQUVOO0FBQUE7QUFHRixtQkFBTztBQUFBLHFCQUNHLGlCQUFpQixRQUFRLE9BQU8sU0FBUyxhQUFhO0FBQ2hFLGdCQUFJLE1BQU0sYUFBYSxRQUFRO0FBRS9CLGdCQUFJLDJCQUFLLFdBQVcsYUFBYTtBQUNoQyxvQkFBTSxJQUFJLElBQUksTUFBTSxLQUFLLFlBQVksYUFBYTtBQUFBO0FBR25ELGdCQUFJLE9BQVEsYUFBWSxJQUFJLFFBQVEsWUFBWSxJQUFJLElBQUksT0FBTyxNQUFNO0FBQ3BFLG9CQUFNLGdCQUFnQixNQUFPLGFBQVksSUFBSSxRQUFRLFlBQVksSUFBSSxJQUFJLE9BQU87QUFDaEYsb0JBQU0sVUFBVSxhQUFhLFVBQVU7QUFDdkMsb0JBQU0sUUFBUSxjQUFjO0FBQzVCLDJCQUNDLE9BQU8sWUFDUCxhQUFhLGlDQUNULFFBRFM7QUFBQSxnQkFFWixLQUFLO0FBQUEsbUJBRU47QUFFRCxxQkFBTztBQUFBO0FBQUE7QUFBQTtBQUtWLGNBQU0sVUFBVSxvQkFBb0I7QUFDcEMsWUFBSSxlQUFlO0FBQ25CLG1CQUFXLFFBQVEsV0FBVyxXQUFXO0FBQ3hDLGNBQUksZ0JBQWdCLE1BQU0sU0FBUyxhQUFhO0FBQy9DLGtCQUFNLE1BQU0sYUFBYSxNQUFNO0FBQy9CLG9CQUFRO0FBQUEsbUJBQ0YsY0FBYztBQUNsQixvQkFBSSxDQUFDLGNBQWM7QUFDbEIsd0JBQU0sUUFBUSxjQUFjO0FBQzVCLHlCQUFPLE1BQU07QUFDYixpQ0FBZSx3QkFBd0IsTUFBTSxVQUFVLFlBQVksSUFBSSxVQUFVO0FBQUE7QUFFbEYsdUJBQU87QUFDUDtBQUFBO0FBQUEsbUJBRUksV0FBVztBQUNmLG9CQUFJLGFBQWEsTUFBTSxVQUFVLFNBQVM7QUFDekMsd0JBQU0sUUFBUSxjQUFjO0FBQzVCLDBDQUF3QixNQUFNLFVBQVUsWUFBWSxJQUFJLFVBQVU7QUFDbEUseUJBQU87QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU1YLGNBQUksaUJBQWlCLE1BQU0sU0FBUyxhQUFhO0FBQ2hELGtCQUFNLE1BQU0sYUFBYSxNQUFNO0FBQy9CLGtCQUFNLGNBQWMsV0FBVyxJQUFJO0FBQ25DLGdCQUFJLGFBQWE7QUFDaEIsb0JBQU0sV0FBVyxLQUFLLFlBQVk7QUFDbEMsb0JBQU0sVUFBVSxhQUFhLFVBQVUsTUFBTTtBQUM3QywyQkFBYSxNQUFNLE9BQU87QUFBQTtBQUFBO0FBSzVCLGNBQUksVUFBVSxPQUFPO0FBQ3BCLGtCQUFNLFNBQVMsYUFBYSxNQUFNO0FBQ2xDLGdCQUFJLGdCQUFnQjtBQUNwQixrQkFBTSxPQUFPLFlBQVksUUFBUSxJQUFJLENBQUMsTUFBTSxFQUFFO0FBQzlDLHVCQUFXLE9BQU8sTUFBTTtBQUN2QixrQkFBSSxXQUFXLElBQUksTUFBTTtBQUN4QixzQkFBTSxjQUFjLFdBQVcsSUFBSTtBQUNuQyxzQkFBTSxXQUFXLEtBQUssWUFBWTtBQUNsQyxzQkFBTSxVQUFVLGFBQWEsVUFBVSxNQUFNO0FBQzdDLGdDQUFnQixjQUFjLFFBQVEsS0FBSztBQUFBO0FBQUE7QUFJN0MsZ0JBQUksa0JBQWtCLFFBQVE7QUFDN0IsMkJBQWEsTUFBTSxVQUFVO0FBQUE7QUFBQTtBQUFBO0FBTWhDLG1CQUFXLFNBQVMsaUJBQWlCLFdBQVc7QUFDL0MsY0FBSSxhQUFhLE9BQU8sZ0JBQWdCO0FBQ3ZDLGdCQUFJLENBQUMsY0FBYztBQUNsQiw2QkFBZSx3QkFBd0IsT0FBTyxVQUFVLFlBQVksSUFBSTtBQUFBO0FBR3pFLG1CQUFPO0FBQUE7QUFBQTtBQUlULGNBQU0sVUFBVSxPQUFPLFVBQVU7QUFDakMsY0FBTSxPQUFPLFNBQVMsT0FBTztBQUM3QixZQUFJO0FBR0osWUFBSSxZQUFZLGFBQWEsa0JBQWtCLFVBQVUsbUJBQW1CLEtBQUssT0FBTztBQUN2RixvQkFBVSxHQUFHLHlCQUF5QixRQUFRO0FBQUEsZUFDeEM7QUFDTixvQkFBVSxNQUFNLE1BQU0sS0FBSyxNQUFNO0FBQUE7QUFHbEMsYUFBSyxTQUFTO0FBQUEsVUFDYixVQUFVO0FBQUEsVUFDVixRQUFRO0FBQUEsVUFDUixNQUFNO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTsiLAogICJuYW1lcyI6IFtdCn0K
