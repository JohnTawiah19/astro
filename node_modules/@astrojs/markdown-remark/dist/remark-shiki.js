import { getHighlighter } from "shiki";
import { visit } from "unist-util-visit";
const highlighterCache = new Map();
const remarkShiki = async ({ langs = [], theme = "github-dark", wrap = false }) => {
  const cacheID = typeof theme === "string" ? theme : theme.name;
  let highlighter = highlighterCache.get(cacheID);
  if (!highlighter) {
    highlighter = await getHighlighter({ theme });
    highlighterCache.set(cacheID, highlighter);
  }
  for (const lang of langs) {
    await highlighter.loadLanguage(lang);
  }
  return () => (tree) => {
    visit(tree, "code", (node) => {
      var _a;
      let html = highlighter.codeToHtml(node.value, { lang: (_a = node.lang) != null ? _a : "plaintext" });
      html = html.replace('<pre class="shiki"', '<pre is:raw class="astro-code"');
      html = html.replace(/style="(background-)?color: var\(--shiki-/g, 'style="$1color: var(--astro-code-');
      if (wrap === false) {
        html = html.replace(/style="(.*?)"/, 'style="$1; overflow-x: auto;"');
      } else if (wrap === true) {
        html = html.replace(/style="(.*?)"/, 'style="$1; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;"');
      }
      node.type = "html";
      node.value = html;
      node.children = [];
    });
  };
};
var remark_shiki_default = remarkShiki;
export {
  remark_shiki_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vc3JjL3JlbWFyay1zaGlraS50cyJdLAogICJtYXBwaW5ncyI6ICJBQUNBO0FBQ0E7QUFrQ0EsTUFBTSxtQkFBbUIsSUFBSTtBQUU3QixNQUFNLGNBQWMsT0FBTyxFQUFFLFFBQVEsSUFBSSxRQUFRLGVBQWUsT0FBTyxZQUF5QjtBQUMvRixRQUFNLFVBQWtCLE9BQU8sVUFBVSxXQUFXLFFBQVEsTUFBTTtBQUNsRSxNQUFJLGNBQWMsaUJBQWlCLElBQUk7QUFDdkMsTUFBSSxDQUFDLGFBQWE7QUFDakIsa0JBQWMsTUFBTSxlQUFlLEVBQUU7QUFDckMscUJBQWlCLElBQUksU0FBUztBQUFBO0FBRS9CLGFBQVcsUUFBUSxPQUFPO0FBQ3pCLFVBQU0sWUFBWSxhQUFhO0FBQUE7QUFFaEMsU0FBTyxNQUFNLENBQUMsU0FBYztBQUMzQixVQUFNLE1BQU0sUUFBUSxDQUFDLFNBQVM7QUFqRGhDO0FBa0RHLFVBQUksT0FBTyxZQUFhLFdBQVcsS0FBSyxPQUFPLEVBQUUsTUFBTSxXQUFLLFNBQUwsWUFBYTtBQUdwRSxhQUFPLEtBQUssUUFBUSxzQkFBc0I7QUFFMUMsYUFBTyxLQUFLLFFBQVEsOENBQThDO0FBR2xFLFVBQUksU0FBUyxPQUFPO0FBQ25CLGVBQU8sS0FBSyxRQUFRLGlCQUFpQjtBQUFBLGlCQUMzQixTQUFTLE1BQU07QUFDekIsZUFBTyxLQUFLLFFBQVEsaUJBQWlCO0FBQUE7QUFHdEMsV0FBSyxPQUFPO0FBQ1osV0FBSyxRQUFRO0FBQ2IsV0FBSyxXQUFXO0FBQUE7QUFBQTtBQUFBO0FBS25CLElBQU8sdUJBQVE7IiwKICAibmFtZXMiOiBbXQp9Cg==
